---
- name: Setup Telegraf
  hosts: station01
  gather_facts: yes
  tasks:
    - name: Install Telegraf
      ansible.builtin.package:
        name: telegraf
        state: present

    - name: Copy Telegraf configuration file
      ansible.builtin.template:
        src: "{{ telegraf.config }}"
        dest: /etc/telegraf/telegraf.conf
      notify:
        - restart_telegraf
        - restart_influxdb

    - name: Start telegraf service
      ansible.builtin.service:
        name: telegraf
        state: started

  handlers:
    - name: restart_telegraf
      ansible.builtin.service:
        name: telegraf
        state: restarted

    - name: restart_influxdb
      ansible.builtin.service:
        name: influxdb
        state: restarted
